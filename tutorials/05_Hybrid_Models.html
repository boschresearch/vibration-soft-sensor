

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hybrid Virtual Sensors &mdash; Template-Python</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
      <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=f65bdc5e" />
      <link rel="stylesheet" type="text/css" href="../_static/css/fix-rtd-property.css?v=3d3ddd9d" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=34f4cfc2"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/thebelab-helper.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Preprocessing" href="../reference.html" />
    <link rel="prev" title="Hyperparameter Optimization" href="04_hyperopt.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            softsensor
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">vibration-soft-sensor   <!-- omit in toc --></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_linear_models.html">Linear Virtual Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_ARNN.html">Autoregressive Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_RNN.html">Recurrent Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_hyperopt.html">Hyperparameter Optimization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Hybrid Virtual Sensors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Data-Loading">Data Loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Data-Preprocessing">Data Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Define-Model">Define Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Model-training">Model training</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Model-Evaluation">Model Evaluation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Data Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html#linear-methods">Linear Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html#neural-networks">Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html#training-methods">Training Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html#postprocessing">Postprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html#frequency-methods">Frequency Methods</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">softsensor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Hybrid Virtual Sensors</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/05_Hybrid_Models.nblink.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Hybrid-Virtual-Sensors">
<h1>Hybrid Virtual Sensors<a class="headerlink" href="#Hybrid-Virtual-Sensors" title="Link to this heading"></a></h1>
<p>In this tutorial we design a hybrid approach using the linear transfer function in frequency domain in combination with autoregressive Neural Networks. This is the fifth tutorial on the SoftSensor Toolbox building upon the other four. Please check out the previous tutorial for more detailed informations concerning the specific models as well as the hyperparameter optimization. Furthermore we utilise advanced techniques for stabelization in the predicition.</p>
<p>Hybrid models are extremely useful for systems that have a <em>strong linear component with slight non-linear deviations</em>. For these cases, hybrid models can offer a strong benefit in terms of accuracy and computational effort compared to pure deep learning or classical models.</p>
<section id="Data-Loading">
<h2>Data Loading<a class="headerlink" href="#Data-Loading" title="Link to this heading"></a></h2>
<p>The data loading process works similarly to the previous tutorials. A steering system under road conditions is used as the data basis. The linear antecedent of the system is significant, which is why the use of hybrid approaches is appropriate.</p>
<p>These are matlab files which require the use of a special function to read the data. The internal function <code class="docutils literal notranslate"><span class="pre">read_vehicle_data</span></code> provides the functionality to read the matfile for the individual sensors.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="n">input_sensors</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;input_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
<span class="n">output_sensors</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;output_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span> <span class="k">if</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>
<span class="n">df_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="Data-Preprocessing">
<h2>Data Preprocessing<a class="headerlink" href="#Data-Preprocessing" title="Link to this heading"></a></h2>
<p>To enable hybrid models, preprocessing is carried out in two steps. In the first step, the data is read into a <code class="docutils literal notranslate"><span class="pre">Meas_handling</span></code> class, filtered and scaled as explained in the previous tutorials.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">softsensor.meas_handling</span><span class="w"> </span><span class="kn">import</span> <span class="n">Meas_handling</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<span class="n">data_handle</span> <span class="o">=</span> <span class="n">Meas_handling</span><span class="p">(</span><span class="n">df_list</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">file_names</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">input_sensors</span><span class="p">,</span> <span class="n">output_sensors</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">df_list</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

<span class="n">freq_lim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1250</span><span class="p">]</span>
<span class="n">data_handle</span><span class="o">.</span><span class="n">Resample</span><span class="p">(</span><span class="n">fs</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
<span class="n">data_handle</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="n">freq_lim</span><span class="p">)</span>
<span class="n">data_handle</span><span class="o">.</span><span class="n">Scale</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>In the second step, the linear solution of the system is calculated. If another solution is known, for example from simulations, this can of course also be used. To calculate the linear solution, the Frequency Response Function (FRF) with the class <code class="docutils literal notranslate"><span class="pre">tf</span></code> is used. A detailed introduction to the calculation of linear solutions is described in <code class="docutils literal notranslate"><span class="pre">tutorial/01_linear_models.ipynb</span></code>.</p>
<p>Then the difference between the linear solution and the original measurement data must be calculated. The use of the difference is necessary because the subsequent training with stability parameters leads to a simpler training with improved properties.</p>
<p>As a last step, the <code class="docutils literal notranslate"><span class="pre">Meas_handling</span></code> class must be adapted so that the linear solution is also used as input in addition to the actual input sensors.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">softsensor.linear_methods</span><span class="w"> </span><span class="kn">import</span> <span class="n">tf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">softsensor.eval_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">comp_batch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># compute linear solution</span>
<span class="n">tf_class</span> <span class="o">=</span> <span class="n">tf</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">hop</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">data_handle</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
<span class="n">tf_class</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_handle</span><span class="o">.</span><span class="n">train_df</span><span class="p">,</span> <span class="n">input_sensors</span><span class="p">,</span> <span class="n">output_sensors</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">comp_batch</span><span class="p">([</span><span class="n">tf_class</span><span class="p">],</span> <span class="n">data_handle</span><span class="p">,</span> <span class="n">data_handle</span><span class="o">.</span><span class="n">train_names</span> <span class="o">+</span> <span class="n">data_handle</span><span class="o">.</span><span class="n">test_names</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;lin&#39;</span><span class="p">])</span>

<span class="c1"># compute difference between linear solution and measured output</span>
<span class="n">lin_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">_lin&#39;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">output_sensors</span><span class="p">]</span>
<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">data_handle</span><span class="o">.</span><span class="n">train_df</span> <span class="o">+</span> <span class="n">data_handle</span><span class="o">.</span><span class="n">test_df</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">output_sensors</span><span class="p">,</span> <span class="n">lin_labels</span><span class="p">):</span>
        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>

<span class="c1"># redefine input sensors for subsequent models</span>
<span class="n">data_handle</span><span class="o">.</span><span class="n">input_sensors</span> <span class="o">=</span> <span class="n">input_sensors</span> <span class="o">+</span> <span class="n">lin_labels</span>
<span class="n">data_handle</span><span class="o">.</span><span class="n">output_sensors</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">_diff&#39;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">output_sensors</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_handle</span><span class="o">.</span><span class="n">train_df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>input_1</th>
      <th>input_2</th>
      <th>input_3</th>
      <th>input_4</th>
      <th>input_5</th>
      <th>input_6</th>
      <th>input_7</th>
      <th>input_8</th>
      <th>input_9</th>
      <th>output_1</th>
      <th>output_2</th>
      <th>output_3</th>
      <th>output_1_lin</th>
      <th>output_2_lin</th>
      <th>output_3_lin</th>
      <th>output_1_diff</th>
      <th>output_2_diff</th>
      <th>output_3_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.000000</th>
      <td>-0.000055</td>
      <td>2.362300e-04</td>
      <td>0.000162</td>
      <td>0.000200</td>
      <td>0.000197</td>
      <td>-0.000057</td>
      <td>0.000119</td>
      <td>0.000038</td>
      <td>0.000065</td>
      <td>-0.000035</td>
      <td>0.000205</td>
      <td>0.000270</td>
      <td>-0.061786</td>
      <td>0.040316</td>
      <td>0.033076</td>
      <td>0.061751</td>
      <td>-0.040111</td>
      <td>-0.032806</td>
    </tr>
    <tr>
      <th>0.000244</th>
      <td>0.000846</td>
      <td>1.571275e-04</td>
      <td>0.001680</td>
      <td>0.000504</td>
      <td>0.000207</td>
      <td>-0.000031</td>
      <td>-0.044669</td>
      <td>0.000102</td>
      <td>-0.079320</td>
      <td>0.026044</td>
      <td>-0.021564</td>
      <td>0.041598</td>
      <td>-0.029128</td>
      <td>0.027044</td>
      <td>0.009610</td>
      <td>0.055172</td>
      <td>-0.048608</td>
      <td>0.031988</td>
    </tr>
    <tr>
      <th>0.000488</th>
      <td>-0.000661</td>
      <td>7.843154e-05</td>
      <td>-0.002396</td>
      <td>-0.000110</td>
      <td>0.000374</td>
      <td>0.000197</td>
      <td>-0.046712</td>
      <td>0.000137</td>
      <td>-0.096743</td>
      <td>0.029387</td>
      <td>-0.026593</td>
      <td>0.017143</td>
      <td>0.032557</td>
      <td>-0.020947</td>
      <td>-0.019499</td>
      <td>-0.003170</td>
      <td>-0.005646</td>
      <td>0.036643</td>
    </tr>
    <tr>
      <th>0.000732</th>
      <td>-0.001176</td>
      <td>4.163388e-07</td>
      <td>-0.001527</td>
      <td>0.000837</td>
      <td>0.000088</td>
      <td>0.000009</td>
      <td>-0.032656</td>
      <td>0.000191</td>
      <td>-0.080102</td>
      <td>0.024924</td>
      <td>-0.022350</td>
      <td>-0.018312</td>
      <td>0.070948</td>
      <td>-0.031617</td>
      <td>-0.043709</td>
      <td>-0.046025</td>
      <td>0.009267</td>
      <td>0.025397</td>
    </tr>
    <tr>
      <th>0.000977</th>
      <td>0.001343</td>
      <td>-7.922324e-05</td>
      <td>0.002755</td>
      <td>0.001199</td>
      <td>0.000177</td>
      <td>0.000058</td>
      <td>-0.025086</td>
      <td>0.000270</td>
      <td>-0.082876</td>
      <td>0.024607</td>
      <td>-0.022111</td>
      <td>0.011009</td>
      <td>0.046411</td>
      <td>0.014800</td>
      <td>-0.034840</td>
      <td>-0.021804</td>
      <td>-0.036911</td>
      <td>0.045850</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4.656982</th>
      <td>0.054889</td>
      <td>1.438318e-01</td>
      <td>0.126539</td>
      <td>0.012586</td>
      <td>0.063341</td>
      <td>-0.003280</td>
      <td>-0.084506</td>
      <td>0.008417</td>
      <td>-0.087022</td>
      <td>0.119114</td>
      <td>-0.026520</td>
      <td>-0.005468</td>
      <td>0.048806</td>
      <td>0.021063</td>
      <td>-0.026784</td>
      <td>0.070308</td>
      <td>-0.047583</td>
      <td>0.021317</td>
    </tr>
    <tr>
      <th>4.657227</th>
      <td>0.064895</td>
      <td>7.503008e-02</td>
      <td>0.045369</td>
      <td>-0.012234</td>
      <td>0.047204</td>
      <td>-0.001684</td>
      <td>-0.047624</td>
      <td>0.062081</td>
      <td>-0.079236</td>
      <td>0.136890</td>
      <td>-0.065045</td>
      <td>0.013452</td>
      <td>0.029303</td>
      <td>-0.014047</td>
      <td>-0.021032</td>
      <td>0.107587</td>
      <td>-0.050998</td>
      <td>0.034484</td>
    </tr>
    <tr>
      <th>4.657471</th>
      <td>0.054527</td>
      <td>-6.909275e-02</td>
      <td>0.132877</td>
      <td>-0.075560</td>
      <td>-0.013636</td>
      <td>0.001647</td>
      <td>-0.007482</td>
      <td>0.076393</td>
      <td>-0.040331</td>
      <td>0.071363</td>
      <td>-0.060544</td>
      <td>-0.133363</td>
      <td>0.004782</td>
      <td>-0.024253</td>
      <td>-0.032297</td>
      <td>0.066581</td>
      <td>-0.036291</td>
      <td>-0.101066</td>
    </tr>
    <tr>
      <th>4.657715</th>
      <td>0.020842</td>
      <td>-1.246632e-01</td>
      <td>0.194103</td>
      <td>-0.078980</td>
      <td>-0.048692</td>
      <td>-0.000708</td>
      <td>0.009590</td>
      <td>0.039913</td>
      <td>-0.000082</td>
      <td>-0.007840</td>
      <td>-0.022662</td>
      <td>-0.181809</td>
      <td>0.013488</td>
      <td>0.003680</td>
      <td>-0.023197</td>
      <td>-0.021328</td>
      <td>-0.026342</td>
      <td>-0.158612</td>
    </tr>
    <tr>
      <th>4.657959</th>
      <td>-0.000055</td>
      <td>2.339068e-04</td>
      <td>0.000162</td>
      <td>0.000200</td>
      <td>0.000198</td>
      <td>-0.000058</td>
      <td>0.000118</td>
      <td>0.000038</td>
      <td>0.000064</td>
      <td>-0.000035</td>
      <td>0.000204</td>
      <td>0.000268</td>
      <td>0.008802</td>
      <td>0.023379</td>
      <td>0.041278</td>
      <td>-0.008838</td>
      <td>-0.023175</td>
      <td>-0.041010</td>
    </tr>
  </tbody>
</table>
<p>19080 rows × 18 columns</p>
</div></div>
</div>
</section>
<section id="Define-Model">
<h2>Define Model<a class="headerlink" href="#Define-Model" title="Link to this heading"></a></h2>
<p>We define an Autoregressive Neural Network (ARNN) to approximate the functional dependency between input and output as a simple Neural Network. The model is autoregressive as it feeds back in the past outputs into the equation, leading to:</p>
<p><span class="math notranslate nohighlight">\(y_i(t+1) = f(\mathbf{x}_i(t, ..., t-w_x), \mathbf{y}_i(t, ..., t-w_y))\)</span></p>
<p>Formally this model is called NARX (nonlinear autoregressive model with exogenious input) and takes:</p>
<ul class="simple">
<li><p>number of input channels (<code class="docutils literal notranslate"><span class="pre">input_channels</span></code>)</p></li>
<li><p>number of output channels (<code class="docutils literal notranslate"><span class="pre">pred_size</span></code>)</p></li>
<li><p>window size (<code class="docutils literal notranslate"><span class="pre">window_size</span></code>)</p></li>
<li><p>recurretn window size (<code class="docutils literal notranslate"><span class="pre">rnn_window</span></code>)</p></li>
<li><p>neurons in the hidden layers (<code class="docutils literal notranslate"><span class="pre">hidden_size</span></code>)</p></li>
</ul>
<p>as input. We need to define an extendet input space as <code class="docutils literal notranslate"><span class="pre">len(input_sensors</span> <span class="pre">+</span> <span class="pre">output_sensors)</span></code> to include the additional input from the linear solution.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">softsensor.autoreg_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ARNN</span>

<span class="n">ARNN</span> <span class="o">=</span> <span class="n">ARNN</span><span class="p">(</span><span class="n">input_channels</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">input_sensors</span> <span class="o">+</span> <span class="n">output_sensors</span><span class="p">),</span> <span class="n">pred_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">output_sensors</span><span class="p">),</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">rnn_window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">hidden_size</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;leaky_relu&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Model-training">
<h2>Model training<a class="headerlink" href="#Model-training" title="Link to this heading"></a></h2>
<p>After we have defined the model, the next step is to adapt the model to the data. The training and validation data can be extracted from the predefined <code class="docutils literal notranslate"><span class="pre">data_handle</span></code> class and then trained using the <code class="docutils literal notranslate"><span class="pre">train_model</span></code> function. The setup for the training works similar to normal non-hybrid methods</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.optim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">optim</span>

<span class="n">max_epochs</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># Max Epochs to train the Model</span>
<span class="n">lr</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="c1"># np.logspace(np.log10(1e-5), np.log10(1e-1), max_epochs, endpoint=True)</span>
<span class="n">rel_perm</span> <span class="o">=</span> <span class="mf">5e-4</span> <span class="c1"># gaussian noise added to signals</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">ARNN</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>

<span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span> <span class="o">=</span> <span class="n">data_handle</span><span class="o">.</span><span class="n">give_torch_loader</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="mi">50</span> <span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
                                                         <span class="n">rnn_window</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The training process is done as in <code class="docutils literal notranslate"><span class="pre">tutorials/02_ARNN.ipynb</span></code>. However, we introduce a change and use a scheduler for the stability parameter. Since we know that a negative stability score (SC) means stable behaviour, we use a high parameter if SC is greater than zero and a low parameter if SC is less than zero. We therefore check the SC inbetween the training process and adjust the stabelizer during training. The scheduling results in a SC close to zero after the training process, thus
favouring stable behaviour without interfering too much with the main criterion.</p>
<p>We therefore use a log-function for a SC &lt; 0 and a linear function for SC &gt; 0</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">softsensor.stab_scheduler</span><span class="w"> </span><span class="kn">import</span> <span class="n">log_lin_stab</span>
<span class="n">stab</span> <span class="o">=</span> <span class="n">log_lin_stab</span><span class="p">(</span><span class="n">ARNN</span><span class="p">,</span> <span class="n">s0</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">s1</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">.001</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We visualize the Stability Parameter to show the specific advantages over simpler methods without scheduling</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">stab</span><span class="o">.</span><span class="n">track</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">sc_original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
<span class="n">eta_original</span> <span class="o">=</span> <span class="p">[</span><span class="n">stab</span><span class="o">.</span><span class="n">get_stab</span><span class="p">(</span><span class="n">ARNN</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">sco</span><span class="p">)</span> <span class="k">for</span> <span class="n">sco</span> <span class="ow">in</span> <span class="n">sc_original</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">4.5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sc_original</span><span class="p">,</span> <span class="n">eta_original</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">.001</span><span class="p">,</span> <span class="mf">.03</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sc_original</span><span class="p">,</span> <span class="n">eta_original</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">.001</span><span class="p">,</span> <span class="mf">.03</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;stabelizer&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;SC&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;SC&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;SC&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_05_Hybrid_Models_16_1.png" src="../_images/tutorials_05_Hybrid_Models_16_1.png" />
</div>
</div>
<p>Afterwards we train our model similar to the previous tutorials</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">softsensor.train_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_model</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">ARNN</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">max_epochs</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span>
                        <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(),</span> <span class="n">val_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
                        <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stabelizer</span><span class="o">=</span><span class="n">stab</span><span class="p">,</span>
                        <span class="n">give_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rel_perm</span><span class="o">=</span><span class="n">rel_perm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Training Process finished by early stopping
</pre></div></div>
</div>
</section>
<section id="Model-Evaluation">
<h2>Model Evaluation<a class="headerlink" href="#Model-Evaluation" title="Link to this heading"></a></h2>
<p>To Evaluate our model on testing data we use the predefined functions <code class="docutils literal notranslate"><span class="pre">comp_pred</span></code>, which computes the prediction for a defined track in the data_handle class. As track we choose our testing track, which can be accessed using the internal variable <code class="docutils literal notranslate"><span class="pre">test_names</span></code>. Furthermore we compute</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">softsensor.eval_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">comp_batch</span>
<span class="n">train_pred</span> <span class="o">=</span> <span class="n">comp_batch</span><span class="p">([</span><span class="n">ARNN</span><span class="p">],</span> <span class="n">data_handle</span><span class="p">,</span> <span class="n">data_handle</span><span class="o">.</span><span class="n">train_names</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ARNN&#39;</span><span class="p">])</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">comp_batch</span><span class="p">([</span><span class="n">ARNN</span><span class="p">],</span> <span class="n">data_handle</span><span class="p">,</span> <span class="n">data_handle</span><span class="o">.</span><span class="n">test_names</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ARNN&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Since we have only used one model for the hybrid modelling to calculate the difference between the linear and the measured solution, the linear solution must still be added in post-processing for the model and the output</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_pred</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">out_s</span> <span class="ow">in</span> <span class="n">output_sensors</span><span class="p">:</span>
        <span class="n">train_pred</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_s</span><span class="si">}</span><span class="s1">_ARNN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_s</span><span class="si">}</span><span class="s1">_diff_ARNN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_s</span><span class="si">}</span><span class="s1">_lin&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_pred</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">out_s</span> <span class="ow">in</span> <span class="n">output_sensors</span><span class="p">:</span>
        <span class="n">test_pred</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_s</span><span class="si">}</span><span class="s1">_ARNN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_s</span><span class="si">}</span><span class="s1">_diff_ARNN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_s</span><span class="si">}</span><span class="s1">_lin&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Afterwards we visualize the results</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;output_1&quot;</span><span class="p">,</span> <span class="s2">&quot;output_1_lin&quot;</span><span class="p">,</span> <span class="s2">&quot;output_1_ARNN&quot;</span><span class="p">]</span>
<span class="n">test_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">test_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cols</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mf">3.02</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_05_Hybrid_Models_24_1.png" src="../_images/tutorials_05_Hybrid_Models_24_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_05_Hybrid_Models_24_2.png" src="../_images/tutorials_05_Hybrid_Models_24_2.png" />
</div>
</div>
<p>Lastly we compute a comparison for as a Mean-Squared-Error in Frequency domain (MSLE) as well as Mean Square Error(MSE) in time domain.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">softsensor.eval_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">comp_error</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">comp_error</span><span class="p">(</span><span class="n">test_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">output_sensors</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ARNN&#39;</span><span class="p">,</span> <span class="s1">&#39;lin&#39;</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;JSD&#39;</span><span class="p">],</span> <span class="n">freq_range</span><span class="o">=</span><span class="n">freq_lim</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;JSD&#39;</span><span class="p">]:</span>
    <span class="n">error</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_05_Hybrid_Models_26_0.png" src="../_images/tutorials_05_Hybrid_Models_26_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_05_Hybrid_Models_26_1.png" src="../_images/tutorials_05_Hybrid_Models_26_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_05_Hybrid_Models_26_2.png" src="../_images/tutorials_05_Hybrid_Models_26_2.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="04_hyperopt.html" class="btn btn-neutral float-left" title="Hyperparameter Optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../reference.html" class="btn btn-neutral float-right" title="Data Preprocessing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Bosch CR.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>